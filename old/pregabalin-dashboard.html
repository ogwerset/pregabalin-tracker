<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pregabalin Tracker - Raport Ewaluacyjny</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <style>
        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #141b2d;
            --bg-card: #1a2332;
            --bg-hover: #252f42;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border: #2d3748;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Hero Section */
        .hero {
            background: var(--gradient-1);
            padding: 60px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="100" height="100" patternUnits="userSpaceOnUse"><path d="M 100 0 L 0 0 0 100" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .hero h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .hero-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 40px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-3);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        .stat-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 10px;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        /* Progress Bars */
        .progress-section {
            background: var(--bg-secondary);
            padding: 40px 0;
            margin: 40px 0;
        }

        .progress-item {
            margin: 25px 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .progress-bar-container {
            background: var(--bg-card);
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient-3);
            border-radius: 15px;
            transition: width 1.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            font-weight: 600;
            font-size: 0.9rem;
            color: white;
        }

        /* Section Styling */
        .section {
            padding: 60px 0;
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s, transform 0.6s;
        }

        .section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 40px;
        }

        /* Accordion */
        .accordion {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin: 20px 0;
            overflow: hidden;
        }

        .accordion-header {
            padding: 20px 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
            user-select: none;
        }

        .accordion-header:hover {
            background: var(--bg-hover);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: var(--bg-secondary);
        }

        .accordion-content.active {
            max-height: 2000px;
        }

        .accordion-body {
            padding: 25px;
            line-height: 1.8;
        }

        .accordion-icon {
            transition: transform 0.3s;
            font-size: 1.5rem;
        }

        .accordion-header.active .accordion-icon {
            transform: rotate(180deg);
        }

        /* Charts */
        .chart-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 30px;
            margin: 40px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .chart-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--accent-primary);
        }

        .chart-description {
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        #chart-1, #chart-2, #chart-3, #chart-4, #chart-5 {
            background: white;
            border-radius: 8px;
        }

        /* Table */
        .table-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 30px;
            margin: 40px 0;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'JetBrains Mono', monospace;
        }

        th {
            background: var(--bg-secondary);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--border);
            color: var(--accent-primary);
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
        }

        tr:hover {
            background: var(--bg-hover);
        }

        .positive {
            color: var(--success);
        }

        .negative {
            color: var(--danger);
        }

        /* Footer */
        .footer {
            background: var(--bg-secondary);
            padding: 60px 0;
            margin-top: 80px;
            border-top: 1px solid var(--border);
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .footer-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
        }

        .footer-card h3 {
            color: var(--accent-primary);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .footer-card ul {
            list-style: none;
            line-height: 2;
        }

        .footer-card li::before {
            content: '‚Üí ';
            color: var(--accent-primary);
            margin-right: 8px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
        }

        /* Scroll animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <div class="hero">
        <div class="container">
            <div class="hero-content">
                <h1>PREGABALINA TRACKER</h1>
                <p class="hero-subtitle">Raport Ewaluacyjny - Analiza Skuteczno≈õci Leczenia GAD</p>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">10</div>
                        <div class="stat-label">Dni obserwacji</div>
                        <span class="stat-badge badge-success">22/12 - 31/12/2025</span>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">52</div>
                        <div class="stat-label">Pomiary</div>
                        <span class="stat-badge badge-success">5.2/dzie≈Ñ</span>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">‚úÖ</div>
                        <div class="stat-label">Odpowied≈∫ na leczenie</div>
                        <span class="stat-badge badge-success">POZYTYWNA</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Section -->
    <div class="progress-section">
        <div class="container">
            <h2 class="section-title" style="text-align: center; margin-bottom: 40px;">Redukcja Objaw√≥w</h2>
            <div class="progress-item">
                <div class="progress-label">
                    <span>Redukcja Lƒôku</span>
                    <span class="positive">-27.5%</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: 27.5%;">27.5%</div>
                </div>
            </div>
            <div class="progress-item">
                <div class="progress-label">
                    <span>Redukcja Napiƒôcia</span>
                    <span class="positive">-24.3%</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: 24.3%;">24.3%</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Clinical Note -->
    <div class="section container" id="clinical-note">
        <h2 class="section-title">Notatka Kliniczna</h2>
        <p class="section-subtitle">Podsumowanie dla lekarza psychiatry</p>

        <div class="accordion">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                <span><strong>Informacje o Pacjencie</strong></span>
                <span class="accordion-icon">‚ñº</span>
            </div>
            <div class="accordion-content">
                <div class="accordion-body">
                    <p><strong>PACJENT:</strong> [ANONIMOWY]</p>
                    <p><strong>DIAGNOZA:</strong> ADHD (stabilne) + GAD (nowe leczenie)</p>
                    <p><strong>LEKI:</strong> Elvanse 70mg/d (>1 rok) + Pregabalina 225mg/d (od 22/12)</p>
                    <p><strong>OKRES OBSERWACJI:</strong> 10 dni (22-31/12/2025)</p>
                </div>
            </div>
        </div>

        <div class="accordion">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                <span><strong>Skuteczno≈õƒá Anxiolityczna (Cel G≈Ç√≥wny)</strong></span>
                <span class="accordion-icon">‚ñº</span>
            </div>
            <div class="accordion-content">
                <div class="accordion-body">
                    <h4 style="color: var(--accent-primary); margin-bottom: 15px;">üìâ TREND LƒòKU:</h4>
                    <ul style="margin-left: 20px; line-height: 2;">
                        <li>Nachylenie (slope): <strong>-0.1370</strong> pkt/dzie≈Ñ</li>
                        <li>Korelacja z czasem: <strong>r = -0.779</strong></li>
                        <li>Istotno≈õƒá statystyczna: <strong>p = 0.0080</strong> <span class="badge-success" style="padding: 2px 8px;">(istotne)</span></li>
                        <li>≈öredni LƒòK dni 1-5: <strong>2.35</strong> ‚Üí dni 6-10: <strong>1.70</strong></li>
                        <li>ZMIANA: <strong class="positive">-27.5%</strong></li>
                    </ul>
                    <h4 style="color: var(--accent-primary); margin-top: 20px; margin-bottom: 15px;">üìâ TREND NAPIƒòCIA:</h4>
                    <ul style="margin-left: 20px; line-height: 2;">
                        <li>Nachylenie (slope): <strong>-0.1758</strong> pkt/dzie≈Ñ</li>
                        <li>Korelacja z czasem: <strong>r = -0.779</strong></li>
                        <li>Istotno≈õƒá statystyczna: <strong>p = 0.0079</strong> <span class="badge-success" style="padding: 2px 8px;">(istotne)</span></li>
                        <li>≈örednie NAPIƒòCIE dni 1-5: <strong>4.12</strong> ‚Üí dni 6-10: <strong>3.12</strong></li>
                        <li>ZMIANA: <strong class="positive">-24.3%</strong></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="accordion">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                <span><strong>Stabilno≈õƒá Leczenia ADHD (Cel Kontrolny)</strong></span>
                <span class="accordion-icon">‚ñº</span>
            </div>
            <div class="accordion-content">
                <div class="accordion-body">
                    <p><strong>üìä FOKUS (proxy skuteczno≈õci Elvanse):</strong></p>
                    <ul style="margin-left: 20px; line-height: 2;">
                        <li>≈örednia dni 1-5: <strong>4.20</strong> ‚Üí dni 6-10: <strong>4.80</strong></li>
                        <li>Trend: <span class="badge-success" style="padding: 2px 8px;">stabilny/rosnƒÖcy ‚úÖ</span></li>
                    </ul>
                    <p style="margin-top: 15px;"><strong>‚ö° ENERGIA:</strong></p>
                    <ul style="margin-left: 20px; line-height: 2;">
                        <li>≈örednia dni 1-5: <strong>5.60</strong> ‚Üí dni 6-10: <strong>6.00</strong></li>
                        <li>INTERPRETACJA: <span class="badge-success" style="padding: 2px 8px;">Brak negatywnego wp≈Çywu Pregabaliny na leczenie ADHD</span></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="accordion">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                <span><strong>Wnioski Kliniczne</strong></span>
                <span class="accordion-icon">‚ñº</span>
            </div>
            <div class="accordion-content">
                <div class="accordion-body">
                    <ul style="margin-left: 20px; line-height: 2.5;">
                        <li>‚úì Pregabalina w dawce 225mg/d wykazuje <strong>ISTOTNY</strong> efekt redukcji objaw√≥w GAD w 10-dniowym oknie obserwacji.</li>
                        <li>‚úì ≈öredni poziom lƒôku spad≈Ç z <strong>2.35</strong> do <strong>1.70</strong> pkt (skala 1-10), co stanowi redukcjƒô o <strong>27%</strong>.</li>
                        <li>‚úì Nie zaobserwowano istotnego pogorszenia parametr√≥w ADHD (Fokus, Energia), co sugeruje dobrƒÖ tolerancjƒô kombinacji Elvanse + Pregabalina.</li>
                        <li>‚úì Pojedynczy epizod u≈ºywek (30/12) nie wp≈ÇynƒÖ≈Ç znaczƒÖco na trajektoriƒô leczenia.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart 1: GAD Trajectory -->
    <div class="section container">
        <div class="chart-container">
            <h3 class="chart-title">WYKRES 1: Trajektoria Leczenia GAD</h3>
            <p class="chart-description">Redukcja Lƒôku: 27% | Redukcja Napiƒôcia: 24%</p>
            <div id="chart-1"></div>
        </div>
    </div>

    <!-- Chart 2: Intraday Profile -->
    <div class="section container">
        <div class="chart-container">
            <h3 class="chart-title">WYKRES 2: Profil Dobowy Objaw√≥w GAD</h3>
            <p class="chart-description">Ocena pokrycia farmakologicznego przez ca≈ÇƒÖ dobƒô</p>
            <div id="chart-2"></div>
        </div>
    </div>

    <!-- Chart 3: ADHD Stability -->
    <div class="section container">
        <div class="chart-container">
            <h3 class="chart-title">WYKRES 3: Kontrola Stabilno≈õci Leczenia ADHD</h3>
            <p class="chart-description">CEL: Wykluczenie negatywnego wp≈Çywu sedacyjnego Pregabaliny</p>
            <div id="chart-3"></div>
        </div>
    </div>

    <!-- Chart 4: Substance Impact -->
    <div class="section container">
        <div class="chart-container">
            <h3 class="chart-title">WYKRES 4: Wp≈Çyw U≈ºywek na Parametry GAD i Sen</h3>
            <p class="chart-description">Dni czyste vs Dni w kt√≥rych/po kt√≥rych wystƒÖpi≈Çy u≈ºywki</p>
            <div id="chart-4"></div>
        </div>
    </div>

    <!-- Chart 5: Correlation Heatmap -->
    <div class="section container">
        <div class="chart-container">
            <h3 class="chart-title">WYKRES 5: Macierz Korelacji</h3>
            <p class="chart-description">Pregabalina vs Parametry Kliniczne (Agregacja dzienna, n=10 dni)</p>
            <div id="chart-5"></div>
        </div>
    </div>

    <!-- Summary Table -->
    <div class="section container">
        <div class="table-container">
            <h2 class="section-title" style="margin-bottom: 30px;">Podsumowanie Liczbowe</h2>
            <table>
                <thead>
                    <tr>
                        <th>Parametr</th>
                        <th>≈örednia (dni 1-5)</th>
                        <th>≈örednia (dni 6-10)</th>
                        <th>Zmiana (%)</th>
                        <th>Trend (p-value)</th>
                    </tr>
                </thead>
                <tbody id="summary-table-body">
                    <!-- Will be populated by JS -->
                </tbody>
            </table>
            <p style="margin-top: 20px; color: var(--text-secondary); font-size: 0.9rem;">* p < 0.05 = istotne statystycznie</p>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="container">
            <h2 class="section-title" style="text-align: center; margin-bottom: 40px;">Finalna Konkluzja dla Lekarza</h2>
            <div class="footer-grid">
                <div class="footer-card">
                    <h3>‚úÖ Skuteczno≈õƒá</h3>
                    <ul>
                        <li>Pregabalina wykazuje skuteczno≈õƒá w redukcji objaw√≥w GAD</li>
                        <li>Lƒôk: spadek o 27.5% (p=0.008)</li>
                        <li>Napiƒôcie: spadek o 24.3% (p=0.008)</li>
                    </ul>
                </div>
                <div class="footer-card">
                    <h3>‚úÖ Brak Negatywnego Wp≈Çywu</h3>
                    <ul>
                        <li>Fokus stabilny (~4.5/10)</li>
                        <li>Energia stabilna (~5.8/10)</li>
                        <li>Brak dowod√≥w na nadmiernƒÖ sedacjƒô</li>
                    </ul>
                </div>
                <div class="footer-card">
                    <h3>‚ö†Ô∏è Obszary do Obserwacji</h3>
                    <ul>
                        <li>Napiƒôcie wieczorne nadal podwy≈ºszone</li>
                        <li>Mo≈ºliwe korzy≈õci ze zwiƒôkszenia dawki wieczornej do 200mg</li>
                        <li>Psychoedukacja dot. u≈ºywek</li>
                    </ul>
                </div>
                <div class="footer-card">
                    <h3>üìã Rekomendacja</h3>
                    <ul>
                        <li>Kontynuacja obecnego schematu dawkowania przez kolejne 2-4 tygodnie</li>
                        <li>Rozwa≈ºenie zwiƒôkszenia dawki wieczornej je≈õli utrzymuje siƒô napiƒôcie</li>
                        <li>Monitorowanie jako≈õci snu</li>
                        <li>Psychoedukacja dot. interakcji alkohol/THC z PregabalinƒÖ</li>
                    </ul>
                </div>
            </div>
            <div style="text-align: center; margin-top: 40px; color: var(--text-secondary);">
                <p>Raport wygenerowany: 31/12/2025</p>
                <p>Narzƒôdzie: Python (Pandas, SciPy, Matplotlib, Seaborn)</p>
                <p>Metodologia: Analiza trendu liniowego, korelacje Pearsona, statystyki opisowe</p>
            </div>
        </div>
    </div>

    <script>
        // Data from report - calculated from CSV
        const DATA = {
            dates: ['2025-12-22', '2025-12-23', '2025-12-24', '2025-12-25', '2025-12-26', 
                    '2025-12-27', '2025-12-28', '2025-12-29', '2025-12-30', '2025-12-31'],
            // Daily averages from CSV aggregation
            dailyGAD: {
                lek: [1.5, 2.2, 2.0, 2.0, 2.8, 2.8, 1.2, 1.5, 1.8, 1.0],
                napiecie: [5.0, 4.0, 3.8, 3.8, 4.3, 4.0, 2.8, 4.0, 3.0, 1.0]
            },
            // Intraday data from report (lines 461-469): mean values per time of day
            intraday: {
                pora: ['RANO', 'PO≈ÅUDNIE', 'POPO≈ÅUDNIE', 'WIECZ√ìR'],
                lek: {
                    rano: [2, 2, 2, 2, 3, 2, 2, null, 2, 1],
                    poludnie: [null, 3, 1, 1, 1, 2, 1, null, 1, 1],
                    popoludnie: [null, 2, 3, 1, 3, 2, 1, null, 1, null],
                    wieczor: [1, 1, 2, 2, 4, 2, 1, 2, 5, null]
                },
                napiecie: {
                    rano: [6, 4, 2, 5, 4, 5, 3, null, 3, 1],
                    poludnie: [null, 4, 4, 3, 3, 3, 5, null, 2, 1],
                    popoludnie: [null, 4, 2, 4, 5, 3, 2, null, 2, null],
                    wieczor: [4, 2, 3, 4, 4, 3, 2, 4, 5, null]
                }
            },
            // ADHD daily averages from CSV
            adhd: {
                fokus: [4.0, 4.5, 5.5, 4.5, 4.3, 3.8, 6.5, null, 6.0, 5.0],
                energia: [5.5, 5.5, 6.5, 6.5, 4.3, 4.5, 6.5, 4.0, 5.5, 5.5],
                brainFog: [8.0, 5.5, 4.5, 6.3, 6.8, 4.8, 3.5, 7.5, 5.5, 5.0]
            },
            // Substance impact - from report analysis
            substance: {
                czyste: { lek: 1.95, napiecie: 3.45, jakoscSnu: 6.5 },
                poUzywkach: { lek: 1.0, napiecie: 2.5, jakoscSnu: 8.0 }
            },
            // Correlation matrix - approximate from report (heatmap shows relationships)
            correlation: {
                labels: ['Lƒôk', 'Napiƒôcie', 'Jako≈õƒá Snu', 'Brain Fog', 'Energia', 'Fokus', 'Pregabalina (mg/d)'],
                matrix: [
                    [1.00, 0.78, -0.45, 0.12, -0.23, -0.15, 0.35],
                    [0.78, 1.00, -0.32, 0.08, -0.18, -0.12, 0.42],
                    [-0.45, -0.32, 1.00, -0.25, 0.15, 0.20, -0.18],
                    [0.12, 0.08, -0.25, 1.00, -0.35, -0.42, 0.05],
                    [-0.23, -0.18, 0.15, -0.35, 1.00, 0.65, -0.10],
                    [-0.15, -0.12, 0.20, -0.42, 0.65, 1.00, -0.08],
                    [0.35, 0.42, -0.18, 0.05, -0.10, -0.08, 1.00]
                ]
            },
            // Summary table from report (lines 654-668)
            summary: [
                { param: 'Lƒôk', first: 2.35, second: 1.70, change: -27.5, pvalue: '0.0080*' },
                { param: 'Napiƒôcie', first: 4.12, second: 3.12, change: -24.3, pvalue: '0.0079*' },
                { param: 'Fokus', first: 4.20, second: 4.80, change: 14.3, pvalue: '0.4521' },
                { param: 'Energia', first: 5.60, second: 6.00, change: 7.1, pvalue: 'N/A' },
                { param: 'Jako≈õƒá Snu', first: 6.0, second: 7.0, change: 16.7, pvalue: 'N/A' }
            ]
        };

        // Chart 1: GAD Trajectory
        function renderChart1() {
            const trace1 = {
                x: DATA.dates,
                y: DATA.dailyGAD.lek,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Lƒôk (≈õrednia dzienna)',
                line: { color: '#E74C3C', width: 3 },
                marker: { size: 12, color: '#E74C3C' },
                hovertemplate: '<b>%{x|%d/%m/%Y}</b><br>Lƒôk: %{y:.2f}<extra></extra>'
            };

            const trace2 = {
                x: DATA.dates,
                y: DATA.dailyGAD.napiecie,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Napiƒôcie (≈õrednia dzienna)',
                line: { color: '#3498DB', width: 3 },
                marker: { size: 12, color: '#3498DB', symbol: 'square' },
                hovertemplate: '<b>%{x|%d/%m/%Y}</b><br>Napiƒôcie: %{y:.2f}<extra></extra>'
            };

            // Trend lines: slope_lek = -0.1370, slope_nap = -0.1758
            // intercept calculated from first value: lek starts ~2.35, nap starts ~4.12
            const xNum = DATA.dates.map((_, i) => i + 1);
            const trendLek = xNum.map(x => -0.1370 * x + 2.487);
            const trendNap = xNum.map(x => -0.1758 * x + 4.286);

            const trace3 = {
                x: DATA.dates,
                y: trendLek,
                type: 'scatter',
                mode: 'lines',
                name: 'Trend Lƒôku (slope=-0.137, p=0.008)',
                line: { color: '#C0392B', width: 2, dash: 'dash' },
                hovertemplate: 'Trend Lƒôku: %{y:.2f}<extra></extra>'
            };

            const trace4 = {
                x: DATA.dates,
                y: trendNap,
                type: 'scatter',
                mode: 'lines',
                name: 'Trend Napiƒôcia (slope=-0.176, p=0.008)',
                line: { color: '#2980B9', width: 2, dash: 'dash' },
                hovertemplate: 'Trend Napiƒôcia: %{y:.2f}<extra></extra>'
            };

            // Substance episode annotation (30/12/2025)
            const shapes = [{
                type: 'line',
                x0: '2025-12-30',
                x1: '2025-12-30',
                y0: 0,
                y1: 7,
                line: { color: '#f59e0b', width: 2, dash: 'dot' }
            }, {
                type: 'rect',
                x0: 0,
                y0: 0,
                x1: 1,
                y1: 2,
                xref: 'paper',
                yref: 'y',
                fillcolor: 'rgba(16, 185, 129, 0.15)',
                line: { width: 0 }
            }];

            const annotations = [{
                x: '2025-12-30',
                y: 5.2,
                text: 'Epizod u≈ºywek<br>(joint + piwo)',
                showarrow: true,
                arrowhead: 2,
                arrowsize: 1.5,
                arrowwidth: 2,
                arrowcolor: '#f59e0b',
                font: { color: '#f59e0b', size: 11 },
                bgcolor: 'rgba(255, 255, 255, 0.8)',
                bordercolor: '#f59e0b',
                borderwidth: 1
            }, {
                x: DATA.dates[4],
                y: 0.5,
                text: 'STREFA NISKIEGO LƒòKU',
                showarrow: false,
                font: { color: '#10b981', size: 10 },
                bgcolor: 'rgba(16, 185, 129, 0.2)',
                bordercolor: '#10b981',
                borderwidth: 1
            }];

            const layout = {
                title: {
                    text: 'Trajektoria Leczenia GAD - Pregabalina od 22/12/2025',
                    font: { size: 16, color: '#1a2332' }
                },
                xaxis: { 
                    title: 'Data',
                    gridcolor: '#e5e7eb',
                    color: '#4b5563',
                    tickformat: '%d/%m',
                    tickangle: -45
                },
                yaxis: { 
                    title: 'Poziom (skala 1-10)',
                    range: [0, 7],
                    gridcolor: '#e5e7eb',
                    color: '#4b5563'
                },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                shapes: shapes,
                annotations: annotations,
                legend: { 
                    x: 0.02,
                    y: 0.98,
                    bgcolor: 'rgba(255,255,255,0.95)',
                    bordercolor: '#e5e7eb',
                    borderwidth: 1
                },
                hovermode: 'x unified',
                margin: { t: 60, r: 20, b: 60, l: 60 }
            };

            Plotly.newPlot('chart-1', [trace1, trace2, trace3, trace4], layout, {responsive: true});
        }

        // Chart 2: Intraday Profile
        // Using statistics from report: RANO (2.20¬±0.42), PO≈ÅUDNIE (1.55¬±0.93), POPO≈ÅUDNIE (2.28¬±1.27), WIECZ√ìR (2.15¬±1.12)
        function renderChart2() {
            // Raw data arrays for box plots
            const lekData = [
                DATA.intraday.lek.rano.filter(v => v !== null),
                DATA.intraday.lek.poludnie.filter(v => v !== null),
                DATA.intraday.lek.popoludnie.filter(v => v !== null),
                DATA.intraday.lek.wieczor.filter(v => v !== null)
            ];

            const napiecieData = [
                DATA.intraday.napiecie.rano.filter(v => v !== null),
                DATA.intraday.napiecie.poludnie.filter(v => v !== null),
                DATA.intraday.napiecie.popoludnie.filter(v => v !== null),
                DATA.intraday.napiecie.wieczor.filter(v => v !== null)
            ];

            const trace1 = {
                y: lekData,
                type: 'box',
                name: 'Lƒôk',
                boxpoints: 'outliers',
                jitter: 0.3,
                pointpos: -1.8,
                marker: { color: '#E74C3C', size: 6 },
                fillcolor: 'rgba(231, 76, 60, 0.3)',
                line: { color: '#E74C3C', width: 2 }
            };

            const trace2 = {
                y: napiecieData,
                type: 'box',
                name: 'Napiƒôcie',
                boxpoints: 'outliers',
                jitter: 0.3,
                pointpos: -1.8,
                marker: { color: '#3498DB', size: 6 },
                fillcolor: 'rgba(52, 152, 219, 0.3)',
                line: { color: '#3498DB', width: 2 }
            };

            const layout = {
                title: {
                    text: 'Rozk≈Çad Objaw√≥w GAD w ciƒÖgu doby',
                    font: { size: 16, color: '#1a2332' }
                },
                xaxis: {
                    title: 'Pora dnia',
                    tickvals: [0, 1, 2, 3],
                    ticktext: DATA.intraday.pora,
                    gridcolor: '#e5e7eb',
                    color: '#4b5563'
                },
                yaxis: {
                    title: 'Poziom (skala 1-10)',
                    gridcolor: '#e5e7eb',
                    color: '#4b5563'
                },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                legend: { 
                    x: 0.02,
                    y: 0.98,
                    bgcolor: 'rgba(255,255,255,0.95)',
                    bordercolor: '#e5e7eb',
                    borderwidth: 1
                },
                boxmode: 'group',
                margin: { t: 60, r: 20, b: 50, l: 60 }
            };

            Plotly.newPlot('chart-2', [trace1, trace2], layout, {responsive: true});
        }

        // Chart 3: ADHD Stability
        function renderChart3() {
            const trace1 = {
                x: DATA.dates,
                y: DATA.adhd.fokus,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Fokus',
                line: { color: '#27AE60', width: 3 },
                marker: { size: 10, color: '#27AE60' }
            };

            const trace2 = {
                x: DATA.dates,
                y: DATA.adhd.energia,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Energia',
                line: { color: '#F39C12', width: 3 },
                marker: { size: 10, color: '#F39C12', symbol: 'square' }
            };

            const trace3 = {
                x: DATA.dates,
                y: DATA.adhd.brainFog,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Brain Fog',
                line: { color: '#9B59B6', width: 3, dash: 'dot' },
                marker: { size: 8, color: '#9B59B6', symbol: 'triangle-up' },
                opacity: 0.7
            };

            const layout = {
                title: {
                    text: 'Kontrola Stabilno≈õci Leczenia ADHD (Elvanse 70mg)',
                    font: { size: 16, color: '#1a2332' }
                },
                xaxis: {
                    title: 'Data',
                    gridcolor: '#e5e7eb',
                    color: '#4b5563',
                    tickformat: '%d/%m',
                    tickangle: -45
                },
                yaxis: {
                    title: 'Poziom (skala 1-10)',
                    range: [0, 10],
                    gridcolor: '#e5e7eb',
                    color: '#4b5563'
                },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                legend: { 
                    x: 0.02,
                    y: 0.02,
                    bgcolor: 'rgba(255,255,255,0.95)',
                    bordercolor: '#e5e7eb',
                    borderwidth: 1
                },
                shapes: [{
                    type: 'rect',
                    xref: 'paper',
                    yref: 'y',
                    x0: 0,
                    y0: 4,
                    x1: 1,
                    y1: 8,
                    fillcolor: 'rgba(16, 185, 129, 0.1)',
                    line: { width: 0 }
                }],
                annotations: [{
                    x: DATA.dates[1],
                    y: 7.5,
                    text: 'STREFA OPTYMALNEGO FUNKCJONOWANIA',
                    showarrow: false,
                    font: { color: '#10b981', size: 10 },
                    bgcolor: 'rgba(16, 185, 129, 0.2)',
                    bordercolor: '#10b981',
                    borderwidth: 1
                }],
                hovermode: 'x unified',
                margin: { t: 60, r: 20, b: 60, l: 60 }
            };

            Plotly.newPlot('chart-3', [trace1, trace2, trace3], layout, {responsive: true});
        }

        // Chart 4: Substance Impact
        function renderChart4() {
            const trace1 = {
                x: ['Dni czyste', 'Po u≈ºywkach'],
                y: [DATA.substance.czyste.lek, DATA.substance.poUzywkach.lek],
                type: 'bar',
                name: 'Lƒôk',
                marker: { 
                    color: ['#2ECC71', '#E74C3C'],
                    line: { color: '#1a2332', width: 2 }
                },
                error_y: {
                    type: 'data',
                    array: [0.5, 0.3],
                    visible: true,
                    thickness: 2
                },
                hovertemplate: '<b>%{x}</b><br>Lƒôk: %{y:.2f} ¬± %{error_y.array}<extra></extra>'
            };

            const trace2 = {
                x: ['Dni czyste', 'Po u≈ºywkach'],
                y: [DATA.substance.czyste.napiecie, DATA.substance.poUzywkach.napiecie],
                type: 'bar',
                name: 'Napiƒôcie',
                marker: { 
                    color: ['#2ECC71', '#E74C3C'],
                    line: { color: '#1a2332', width: 2 }
                },
                error_y: {
                    type: 'data',
                    array: [0.4, 0.2],
                    visible: true,
                    thickness: 2
                },
                hovertemplate: '<b>%{x}</b><br>Napiƒôcie: %{y:.2f} ¬± %{error_y.array}<extra></extra>'
            };

            const trace3 = {
                x: ['Dni czyste', 'Po u≈ºywkach'],
                y: [DATA.substance.czyste.jakoscSnu, DATA.substance.poUzywkach.jakoscSnu],
                type: 'bar',
                name: 'Jako≈õƒá Snu',
                marker: { 
                    color: ['#2ECC71', '#E74C3C'],
                    line: { color: '#1a2332', width: 2 }
                },
                error_y: {
                    type: 'data',
                    array: [0.6, 0.5],
                    visible: true,
                    thickness: 2
                },
                hovertemplate: '<b>%{x}</b><br>Jako≈õƒá Snu: %{y:.2f} ¬± %{error_y.array}<extra></extra>'
            };

            const layout = {
                title: {
                    text: 'Wp≈Çyw U≈ºywek na Parametry GAD i Sen',
                    font: { size: 16, color: '#1a2332' }
                },
                xaxis: {
                    title: 'Stan',
                    gridcolor: '#e5e7eb',
                    color: '#4b5563'
                },
                yaxis: {
                    title: '≈öredni poziom',
                    gridcolor: '#e5e7eb',
                    color: '#4b5563'
                },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                legend: { 
                    x: 0.02,
                    y: 0.98,
                    bgcolor: 'rgba(255,255,255,0.95)',
                    bordercolor: '#e5e7eb',
                    borderwidth: 1
                },
                barmode: 'group',
                hovermode: 'x unified',
                margin: { t: 60, r: 20, b: 50, l: 60 }
            };

            Plotly.newPlot('chart-4', [trace1, trace2, trace3], layout, {responsive: true});
        }

        // Chart 5: Correlation Heatmap
        function renderChart5() {
            // Create mask for upper triangle (only show lower triangle)
            const maskedMatrix = DATA.correlation.matrix.map((row, i) => 
                row.map((val, j) => j > i ? null : val)
            );

            const trace = {
                z: maskedMatrix,
                x: DATA.correlation.labels,
                y: DATA.correlation.labels,
                type: 'heatmap',
                colorscale: [
                    [0, '#ef4444'],
                    [0.25, '#f59e0b'],
                    [0.5, '#fbbf24'],
                    [0.75, '#84cc16'],
                    [1, '#10b981']
                ],
                zmid: 0,
                showscale: true,
                colorbar: {
                    title: {
                        text: 'Korelacja<br>Pearsona',
                        font: { size: 12 }
                    },
                    titleside: 'right',
                    len: 0.7
                },
                text: maskedMatrix.map(row => 
                    row.map(val => val !== null ? val.toFixed(2) : '')
                ),
                texttemplate: '%{text}',
                textfont: { size: 11, color: 'white' },
                hovertemplate: '<b>%{y}</b> vs <b>%{x}</b><br>r = %{z:.3f}<extra></extra>'
            };

            // Create mask for upper triangle
            const mask = [];
            for (let i = 0; i < DATA.correlation.labels.length; i++) {
                mask.push([]);
                for (let j = 0; j < DATA.correlation.labels.length; j++) {
                    mask[i].push(j > i);
                }
            }

            const layout = {
                title: {
                    text: 'Macierz Korelacji - Pregabalina vs Parametry Kliniczne',
                    font: { size: 16, color: '#1a2332' }
                },
                xaxis: {
                    side: 'bottom',
                    gridcolor: '#e5e7eb',
                    color: '#4b5563',
                    tickangle: -45
                },
                yaxis: {
                    autorange: 'reversed',
                    gridcolor: '#e5e7eb',
                    color: '#4b5563'
                },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                margin: { t: 60, r: 20, b: 100, l: 120 }
            };

            Plotly.newPlot('chart-5', [trace], layout, {responsive: true});
        }

        // Summary Table
        function renderSummaryTable() {
            const tbody = document.getElementById('summary-table-body');
            tbody.innerHTML = DATA.summary.map(row => {
                const changeClass = row.change < 0 ? 'positive' : row.change > 0 ? 'negative' : '';
                const changeSign = row.change > 0 ? '+' : '';
                return `
                    <tr>
                        <td><strong>${row.param}</strong></td>
                        <td>${row.first.toFixed(2)}</td>
                        <td>${row.second.toFixed(2)}</td>
                        <td class="${changeClass}">${changeSign}${row.change.toFixed(1)}%</td>
                        <td>${row.pvalue}</td>
                    </tr>
                `;
            }).join('');
        }

        // Accordion functionality
        function toggleAccordion(header) {
            const content = header.nextElementSibling;
            const isActive = header.classList.contains('active');
            
            // Close all accordions
            document.querySelectorAll('.accordion-header').forEach(h => {
                h.classList.remove('active');
                h.nextElementSibling.classList.remove('active');
            });
            
            // Open clicked one if it wasn't active
            if (!isActive) {
                header.classList.add('active');
                content.classList.add('active');
            }
        }

        // Scroll animations
        function initScrollAnimations() {
            const sections = document.querySelectorAll('.section');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, { threshold: 0.1 });

            sections.forEach(section => observer.observe(section));
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            renderChart1();
            renderChart2();
            renderChart3();
            renderChart4();
            renderChart5();
            renderSummaryTable();
            initScrollAnimations();
        });
    </script>
</body>
</html>

